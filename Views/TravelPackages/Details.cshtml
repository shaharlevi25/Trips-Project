@model TripsProject.Models.TravelPackage



<script>
    function confirmPayment(packageId) {
        window.location.href = `/Payment/Checkout?packageId=${packageId}`;
    }

    
        async function joinWaitlist(packageId) {
        
        const ok = confirm("You will be added to the waiting list. Continue?");
        if (!ok) return;

        try {
        
        const res = await fetch("/Waitlist/Join", {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ packageId })
    });

        if (res.status === 401) {
            alert("To join the waiting list you must be logged in / registered.");
            window.location.href = "/User/Register";
            return;
        }

        const contentType = res.headers.get("content-type") || "";
        if (!contentType.includes("application/json")) {
            alert("Something went wrong. Please try again.");
            return;
        }

        const data = await res.json();

        if (data.status === "already_exists") {
            alert("You are already on the waiting list for this package.");
            return;
        }

        if (data.status === "ok") {
            alert("You have been added to the waiting list.");
            return;
        }

        if (data.status === "not_logged_in") {
            alert("To join the waiting list you must be logged in / registered.");
            window.location.href = data.redirectUrl || "/User/Register";
            return;
        }

        alert("Something went wrong. Please try again.");
    } catch (e) {
        alert("Network error. Please try again.");
    }
    }
</script>


@{
    ViewData["Title"] = "Package Details";
}

<div class="container package-details">
    <div class="card package-card shadow-lg">

        <h2 class="text-center package-title">
            @Model.Destination (@Model.Country)
        </h2>

        <p class="text-center package-dates">
            @Model.StartDate.ToString("dd/MM/yyyy") -
            @Model.EndDate.ToString("dd/MM/yyyy")
        </p>

        <hr />

        <div class="row mb-3">
            <div class="col-md-6">
                <strong>Package Type:</strong> @Model.PackageType
            </div>
            <div class="col-md-6">
                <strong>Amount of people:</strong> @Model.NumOfPeople
            </div>
            
            <div class="col-md-6">
                <strong>Remaining packages:</strong> @Model.Amount
            </div>
        </div>

        <p class="package-price">₪@Model.Price</p>

        @if (Model.AgeLimit != null)
        {
            <p><strong>הגבלת גיל:</strong> @Model.AgeLimit+</p>
        }

        <hr />

        <p class="fw-bold mb-1">Description:</p>
        <p class="package-desc">@Model.Description</p>

        <div class="package-actions">
            <a asp-controller="Trips"
               asp-action="Index"
               class="btn btn-outline-secondary">
                Back to all packages
            </a>
            
            @if (Model.IsAvailable)
            {
                <a href="javascript:void(0);" class="btn btn-primary"
                   onclick="confirmPayment(@Model.PackageId)">
                    Book Now!
                </a>
            }
            else
            {
                <button type="button"
                        class="btn btn-warning"
                        onclick="joinWaitlist(@Model.PackageId)">
                    Join Wait List
                </button>

            }



        </div>

    </div>
    
    <style>
    body {
        background: #f4f6f9;
    }

    .package-details {
        margin-top: 40px;
        margin-bottom: 60px;
    }

    .package-card {
        border-radius: 18px;
        padding: 35px;
        background: #ffffff;
    }

    .package-title {
        font-size: 28px;
        font-weight: 700;
        color: #1f2937;
    }

    .package-dates {
        color: #6b7280;
        font-size: 15px;
    }

    .package-price {
        font-size: 34px;
        font-weight: bold;
        color: #2563eb;
        text-align: center;
        margin: 25px 0;
    }

    .package-desc {
        color: #374151;
        line-height: 1.6;
    }

    .package-actions {
        display: flex;
        justify-content: space-between;
        gap: 15px;
        margin-top: 30px;
    }

    .package-actions .btn {
        flex: 1;
        padding: 12px;
        font-size: 16px;
        border-radius: 10px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        border: none;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #1e40af, #1d4ed8);
    }

    .btn-warning {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        border: none;
        color: #fff;
    }

    .btn-warning:hover {
        background: linear-gradient(135deg, #d97706, #b45309);
    }

    .btn-outline-secondary {
        border-radius: 10px;
    }

    hr {
        margin: 25px 0;
    }
</style>
</div>